# Copyright 2022 VMware, Inc.
# SPDX-License-Identifier: BSD-2-Clause
---
# This task is used for adding Standard key provider on vCenter.
# Parameters:
#   standard_kp_name: the name of the new Standard key provider.
#   mark_default: set the new added key provider used as the
#     default one. Default value is True.
#   kms_info_list: the list of KMS servers info, contains kms_name,
#     kms_ip, kms_port.
#   upload_client_cert: the path of client certificate file.
#   upload_client_key: the path of the corresponding key file.
#   proxy_server: the proxy server IP to connect to KMS server.
#   proxy_port: the proxy server port.
#   kms_username: the username to authenticate to KMS server.
#   kms_password: the user password to authenticate to KMS server. 
#
- name: Add Standard key provider
  community.vmware.vcenter_standard_key_provider:
    hostname: "{{ vsphere_host_name }}"
    username: "{{ vsphere_host_user }}"
    password: "{{ vsphere_host_user_password }}"
    validate_certs: "{{ validate_certs | default(False) }}"
    name: "{{ standard_kp_name }}"
    state: 'present'
    mark_default: "{{ mark_default | default(True) }}"
    kms_info: "{{ kms_info_list }}"
    proxy_server: "{{ kms_proxy_server | default(omit) }}"
    proxy_port: "{{ kms_proxy_port | default(omit) }}"
    kms_username: "{{ kms_username | default(omit) }}"
    kms_password: "{{ kms_password | default(omit) }}"
    make_kms_trust_vc:
      upload_client_cert: "{{ upload_client_cert }}"
      upload_client_key: "{{ upload_client_key }}"
  register: add_standard_kms_result

- name: Display the result of adding Standard key provider
  debug: var=add_standard_kms_result
  when: enable_debug
