# Copyright 2022 VMware, Inc.
# SPDX-License-Identifier: BSD-2-Clause
---
- name: "Set fact of VM advanced setting for enabling NVMe Spec 1.3"
  set_fact:
    vm_advanced_settings:
      - key: "nvme.specVersion"
        value: "103"

# Shutdown guest OS
- include_tasks: ../utils/win_shutdown_restart.yml
  vars:
    set_win_power_state: "shutdown"

# Add extra config for VM
- include_tasks: ../../common/vm_set_extra_config.yml

# Power on VM
- include_tasks: ../../common/vm_set_power_state.yml
  vars:
    vm_power_state_set: 'powered-on' 

- include_tasks: ../../common/vm_get_extra_config.yml

# Check VM extra config key value pair in VMX file
- name: "Check VM extra config is set"
  assert:
    that:
      - vm_advanced_settings[0].key in vm_extra_config
      - vm_extra_config[vm_advanced_settings[0].key] == vm_advanced_settings[0].value
    fail_msg: "Not get VM advanced setting key value pair: '{{ vm_advanced_settings[0].key }}: {{ vm_advanced_settings[0].value }}' in VM extra config."
